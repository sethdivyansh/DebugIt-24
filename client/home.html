<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <div class="home">
      <div class="createOrJoin">
        <button class="createRoomBtn" onclick="createRoom()">
          Create Room
        </button>
        <p>or</p>
        <p>Join with Code</p>
        <div class="joinWithCode">
          <input type="text" class="roomId" placeholder="Room id" />
          <button class="joinRoomBtn" onclick="joinRoom()">Join</button>
        </div>
      </div>
      <div class="popup" id="roomNotFoundPopup" style="display: none">
        <div class="popup-content">
          <h2>Room Not Found</h2>
          <p>The room you are looking for does not exist.</p>
          <button onclick="closeRoomNotFoundPopup()">OK</button>
        </div>
      </div>
    </div>
    <script>
      function GenerateCode(length) {
        var result = "";
        var characters =
          "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        var charactersLength = characters.length;
        for (var i = 0; i < length; i++) {
          result += characters.charAt(
            Math.floor(Math.random() * charactersLength)
          );
        }
        return result;
      }
      function createRoom() {
        let roomId = GenerateCode(6);
        window.location.href = `http://localhost:3000/game/${roomId}`;
      }

      function joinRoom() {
        let roomId = document.querySelector(".roomId").value;
        fetch("/room_exists")
          .then((res) => res.json())
          .then((data) => {
            if (data.rooms.hasOwnProperty(roomId)) {
              closeRoomNotFoundPopup();
              window.location.href = `http://localhost:3000/game/${roomId}`;
            } else {
              console.log("Room not found");
              showRoomNotFoundPopup();
            }
          })
          .catch((err) => {
            console.log(err);
          });
        var roomNotFoundPopup = document.getElementById("roomNotFoundPopup");

        // Function to display the Room Not Found popup
        function showRoomNotFoundPopup() {
          roomNotFoundPopup.style.display = "block";
        }

        // Function to close the Room Not Found popup
        function closeRoomNotFoundPopup() {
          roomNotFoundPopup.style.display = "none";
        }
      }
    </script>
  </body>
</html>
